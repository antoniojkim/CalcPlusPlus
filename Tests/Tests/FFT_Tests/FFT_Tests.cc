

using namespace std;

#include <Catch2>
#include "../EngineTest.h"

TEST_CASE("FFT Tests", "[fft]" ) {

    SECTION("Real Data FFT Tests"){
        requireExprIsEqual("fft{9.83, 1.09, 4.8}", "{15.72, 6.885+3.212954248i, 6.885-3.212954248i}");

        requireExprIsEqual("fft{1.27, -8.26, -9.66, -6.01, -8.82, 6.91, -4.71, 5.44, -2.76, -7.37}", "{-33.97, -11.0007870715+20.3908133355i, 9.678195201-5.7368248804i, 4.5957870715-6.0305767981i, 27.756804799+2.4346386368i, -15.39, 27.756804799-2.4346386368i, 4.5957870715+6.0305767981i, 9.678195201+5.7368248804i, -11.0007870715-20.3908133355i}");

        requireExprIsEqual("fft{9.04, -5.73, 6.08, -9.21, 1.86, -0.99, -6.11, -9.44, -3.14, 5.23,  1.33, 0.84, -2.98}", "{-13.22, 19.9842030253+8.3570746594i, -10.2842871339+1.3332365051i, 19.6366126002-13.9228667284i, -3.997291336+7.7483690206i, 6.8904873617+12.7786887001i, 33.1402754827+8.6045603171i, 33.1402754827-8.6045603171i, 6.8904873617-12.7786887001i, -3.997291336-7.7483690206i, 19.6366126002+13.9228667284i, -10.2842871339-1.3332365051i, 19.9842030253-8.3570746594i}");

        requireExprIsEqual("fft{-6.77, -3.49, 6.23, -0.93, -6.07, -4.13, 3.16}", "{-12.0, -1.1362635206-7.1312362309i, -12.9530313274+14.9969199732i, -3.605705152+5.9739715549i, -3.605705152-5.9739715549i, -12.9530313274-14.9969199732i, -1.1362635206+7.1312362309i}");

        requireExprIsEqual("fft{8.77, 9.56, -4.13, 4.98}", "{19.18, 12.9-4.58i, -9.9, 12.9+4.58i}");

        requireExprIsEqual("fft{-4.02, 9.51, -4.17, 0.17, 6.71, -6.77, 2.15, 2.43, -3.83, 4.79,  3.56, -6.54}", "{3.99, -1.5843542983-1.2385313846i, -8.65-6.0448573184i, -2.68-11.47i, 2.64-37.6894255727i, -14.2456457017+3.6285313846i, -3.19, -14.2456457017-3.6285313846i, 2.64+37.6894255727i, -2.68+11.47i, -8.65+6.0448573184i, -1.5843542983+1.2385313846i}");

        requireExprIsEqual("fft{2.24, -1.88, -6.55}", "{-6.19, 6.455-4.0443386357i, 6.455+4.0443386357i}");

        requireExprIsEqual("fft{9.88, 7.78, -4.85, -3.4 , 8.48, -7.17, -5.33, -1.06, 3.72, 9.61,  8.67, -8.97}", "{17.36, 17.1168188426+15.2763825372i, -14.38-3.9663963493i, 23.59-23.65i, 7.46-35.6282851117i, 4.9231811574+0.1036174628i, 23.78, 4.9231811574-0.1036174628i, 7.46+35.6282851117i, 23.59+23.65i, -14.38+3.9663963493i, 17.1168188426-15.2763825372i}");

        requireExprIsEqual("fft{1.16, -1.93, -1.88, -9.43, -2.49}", "{-14.57, 8.9441270912-4.9703703039i, 1.2408729088+6.8513169567i, 1.2408729088-6.8513169567i, 8.9441270912+4.9703703039i}");

        requireExprIsEqual("fft{2.03, -7.74, 3.6 , 2.82, 3.97, -8.34}", "{-3.66, -12.615-0.1991858429i, 9.105-0.8400446417i, 22.86, 9.105+0.8400446417i, -12.615+0.1991858429i}");

        requireExprIsEqual("fft{-8.49, 0.44, -5.6 , -3.09, 6.17, 5.41}", "{-5.16, -2.76+14.4972652594i, -14.79-5.8889727457i, -10.68, -14.79+5.8889727457i, -2.76-14.4972652594i}");
    }

    SECTION("Complex Data FFT Tests"){
        requireExprIsEqual("fft{-7.27+9.26i, 8.28-3.88i, -7.17+7.81i, -7.06+1.39i, -0.95-3.33i}",
                           "{-14.17+11.25i, 9.7579066345-9.1245641453i, -24.0264711221+12.4060947822i, -11.1683416753+23.4658429731i, 3.256906163+8.30262639i}");

        requireExprIsEqual("fft{-6.56+0.36i, -6.56+0.56i, 0.05-8.72i, -0.81-8.81i, -9.83+0.49i, 1.81+3.8i}", "{-21.9-12.32i, -14.0170162771+14.1573016403i, 5.0651716606+9.2899636191i, -10.78-3.42i, -5.2751716606-22.3199636191i, 7.5470162771+16.7726983597i}");

        requireExprIsEqual("fft{8.29-6.98i, 4.73-8.91i, -1.06-6.15i, -0.32-4.71i, -7.41+1.08i, -8.1-7.74i, -4.85+0.06i, 7.1+9.1i}", "{-1.62-24.25i, 13.2164527369-6.737617972i, -14.25+10.34i, -3.0013719012-17.0332774004i, -8.44+0.27i, 5.7635472631-16.962382028i, 27.83-9.96i, 46.8213719012+8.4932774004i}");

        requireExprIsEqual("fft{-3.24+7.64i, 0.5-6.64i, 4.67+8.26i, 5.37+6.38i, -0.01-2.74i, 1.09-9.22i, 3.58+1.53i, -8.83-8.29i}", "{3.13-3.08i, 5.2394826817-8.8826442765i, -25.45-9.94i, 12.6957012692+10.3951976926i, 6.87+32.46i, 1.7605173183+27.4626442765i, 2.45+0.16i, -32.6157012692+12.5448023074i}");

        requireExprIsEqual("fft{-8.1-9.39i, 4.86-8.64i, -0.43+8.26i, -2.25-0.48i, 2.31-0.42i, 0.56-4.95i, -5.19-0.71i, -2.91-9.24i, -2.72+2.99i, -4.82-5.79i, -4.39+2.66i}", "{-23.08-25.71i, 4.3647070955-17.0195494464i, -8.6285270728-22.6106184722i, -13.089737277-28.945431097i, -31.1706017018+4.0638204668i, -34.925045717-7.956452812i, 16.3186133093-4.8944337377i, 4.7919268453+2.3432776479i, 7.7559184796+0.3730098924i, 1.6131851411-15.9628791527i, -13.0504391024+13.029256711i}");

        requireExprIsEqual("fft{-4.76-7.72i, -7.88-5.56i, -6.2-1.98i, 0.09+2.96i, -0.63-2.48i, 8.04-0.09i, -0.37+1.09i, 0.88+8.67i, -5.83+1.33i, 8.81+3.52i}", "{-7.85-0.26i, -31.2698313462-0.884404152i, 8.3764599689-2.3739461322i, -9.6082238277+17.9441667958i, -5.6023291474+8.414690321i, -27.73-19.26i, 5.4401356111-11.6988205431i, 3.8498600832-12.9329873213i, 16.0357335675-33.1319236457i, 0.7581950908-23.0167753225i}");

        requireExprIsEqual("fft{6.98+3.62i, 7.91+0.08i, -1.2-7.64i, -6.27+7.75i, -9.62+1.28i, -0.76+6.21i, -9.57-2.99i}", "{-12.53+8.31i, 12.40224213-20.7028558232i, 3.1518995655-3.4274789742i, 29.2575986527-7.8534371626i, -7.6787467534+14.5351670732i, -4.7358380057+25.7995475936i, 28.9928444109+8.6790572932i}");

        requireExprIsEqual("fft{-5.73-8.7i, 7.14+1.46i, 5.94+2.81i, -9.14-2.34i, 9.0+9.86i, 5.43-2.35i, -7.73+1.38i, -0.06+5.66i, -6.79-5.16i, 1.3+1.89i, -9.28+8.02i, 8.01+4.18i, -5.84+5.94i, -6.59-4.73i, 8.23-2.38i}", "{-6.11+15.54i, 13.2049130758-32.6950008373i, 3.15290186-29.7455773293i, 30.0493093454-2.4230659056i, 2.4675437859-10.8306345547i, -17.5891913943+7.333783572i, -64.2381339746+12.3699976705i, -6.2941618811-24.9707254096i, 11.8883493185+15.0732101846i, -10.8032521006-43.6022606507i, -57.7208086057-28.363783572i, 11.0383796923+14.9644919872i, 3.2020767298+2.9653288857i, -15.5859035611-24.5110240747i, 17.3879777098-1.6047399661i}");

        requireExprIsEqual("fft{-2.31+1.47i, -5.3-3.26i, 2.16+9.45i, -8.86+6.07i, -8.94+1.06i, -1.21+9.86i, -4.16+1.19i, 9.39-3.94i, -5.57+7.4i, -4.81+4.65i, 4.46+2.76i, -2.4+7.73i, -5.1+8.01i, 3.12+4.66i, 2.87-9.43i, -2.64+9.28i}", "{-29.3+56.96i, -5.3030213814+9.5614619363i, 27.5433809512-2.1420187668i, -4.5942037342-6.814625503i, -30.48+17.66i, -37.3275741609-29.0689632777i, -21.8277582874+44.2108520448i, 8.8811167699-15.8743345438i, -3.88-13.14i, 29.0922882961-6.1047086995i, 25.6766190488-14.0779812332i, 42.8050103488+6.02709734i, -24.02+10.28i, -1.2216927538+17.2522100409i, -6.7522417126-28.7908520448i, -6.2519233845-22.4181372932i}");

        requireExprIsEqual("fft{-1.01-1.68i, 7.92-4.39i, 0.05-7.56i, 3.64+3.32i, -3.55-0.43i, -2.09+3.11i}", "{4.96-7.63i, -12.6549516574-13.4316057455i, 1.1445706006+0.7237771617i, -13.98-11.71i, 1.7854293994+11.8262228383i, 12.6849516574+10.1416057455i}");

        requireExprIsEqual("fft{9.96-5.75i, 2.42+5.45i, -0.37-8.43i}", "{12.01-8.73i, 20.9554326045-6.6762108766i, -3.0854326045-1.8437891234i}");
    }

}

TEST_CASE("IFFT Tests", "[ifft]" ) {
    requireExprIsEqual("ifft{15.72, 6.885+3.212954248i, 6.885-3.212954248i}", "{9.83, 1.09, 4.8}");

    requireExprIsEqual("ifft{2.72+3.34i, 6.89+0.16i, 9.92+0.67i, -5.08-8.21i, 2.14-2.39i, -5.91+7.09i, -2.6-2.58i, 1.67+4.93i, -8.66+2.19i, -6.09+1.72i}", "{-0.5+0.692i, 2.5840225101+2.5355684015i, -0.6511263412+3.254023076i, -0.2851455148-0.0934908823i, 0.7950448595-0.6446835704i, 1.204-0.446i, -1.6209353227+3.2046986454i, 1.1776513595-2.0733352691i, 0.3820168044-1.291038151i, -0.3655283548-1.7977422501i}");

    requireExprIsEqual("ifft{-3.7+6.26i, 6.42-7.53i, -8.0-5.31i, 6.96-7.38i, -6.65+4.41i, 4.79+3.66i, -1.63-8.95i, 2.39-7.42i, -1.07-7.47i, 3.2-2.55i, 4.79+9.17i, 0.78-8.15i, 4.18+2.43i, 4.5-0.47i, -6.64-0.95i, 3.17-7.03i}", "{0.843125-2.33i, 0.1360489753-0.362407371i, -0.4513228272-0.6146746026i, 1.9223578961+1.5479239819i, -1.178125+1.08i, 0.1767524306+0.7133705423i, 1.432195616-0.1697206448i, -2.3471115231+2.3698068971i, -3.183125+2.27875i, -0.2986415083-0.5355104664i, -1.5561771728+0.2409246026i, 1.5566747472+1.4071711661i, 1.708125+0.37875i, -1.1666598976+0.9095472952i, 0.00030438405-1.46902935522i, -1.2944211201+0.8150979549i}");

    requireExprIsEqual("ifft{8.77+5.99i, -3.94+8.06i, -2.56+5.94i, 5.06-8.14i, 9.97-7.84i, -0.78-3.35i, 0.61+4.99i, 9.15-6.91i, -4.91+5.61i, -6.05-4.1i, -9.79+9.32i, -1.91+8.13i, -7.02+8.85i, -8.06+5.71i}", "{-0.8185714286+2.3042857143i, 1.7970576553+4.7957579268i, 0.662035611+0.2773635623i, -2.0252553133-0.9129655806i, 2.4728922158-0.218088945i, 1.339643016+1.0200533854i, 1.1868218868-2.2193416906i, 0.1142857143+2.39i, 1.9036538544-0.4417014434i, -0.2384027902-0.3583065077i, 3.0139951251-1.5018277182i, 1.815610811+0.1268003725i, 0.5391727356+1.3393105206i, -2.992939093-0.6113395964i}");

    requireExprIsEqual("ifft{-5.09-2.03i, -8.09+0.9i, 3.25+4.63i, -2.95+1.84i, -6.81+2.21i, -1.84-7.33i, -3.07+7.76i, 0.59+1.83i}", "{-3.00125+1.22625i, -0.3616024067+0.1212302942i, -0.2475-2.4725i, -0.6650375625-2.9118741411i, 0.07125+1.91625i, 1.5741024067+0.3987697058i, -2.7725-0.58i, 0.3125375625+0.2718741411i}");

    requireExprIsEqual("ifft{-3.99+8.59i, 5.63-3.55i, 7.0-9.05i, 7.68-4.08i, 3.94+3.68i, -3.16-9.72i, -4.39-0.84i, -9.95-7.14i, 9.6+6.17i, 3.41+3.48i, 3.5+8.98i, 7.94-3.63i, -1.0-3.36i, 7.69+0.96i}", "{2.4214285714-0.6792857143i, 3.1460798566-0.3896917789i, -2.5667468117+1.8626294449i, 0.8868306829+1.2185164622i, -0.3359759792+1.8990087498i, 0.0056478281-0.7268703986i, -2.2722164204-1.4746942397i, -0.3271428571+2.7035714286i, -2.2805656649-0.4893369211i, 0.9934846971+1.2537643349i, -0.994980235+1.0623678997i, -1.2462696537+3.385354878i, -0.9409434601-1.4556892193i, -0.4786305539+0.4203550738i}");

    requireExprIsEqual("ifft{-6.05+2.85i, -2.07+0.98i, -8.67-3.68i, 0.41+0.63i, 8.67-5.83i, 5.87-4.47i, 0.05-0.44i, 9.28-2.66i}", "{0.93625-1.5775i, -2.1253129951-1.299889293i, 1.5875-0.59375i, -3.0997153218+0.4982730451i, -2.43625-0.1975i, -0.7446870049+1.289889293i, 1.2225+0.87875i, -1.3902846782+3.8517269549i}");

    requireExprIsEqual("ifft{-7.06+5.32i, 2.16+8.15i, 5.4-5.16i, -7.73+1.69i, -9.46+8.09i, -1.79-2.47i, -0.44-9.94i}", "{-2.7028571429+0.8114285714i, -0.0067375396+0.9833464092i, -6.4600482844+2.3932936027i, -0.892325472-0.4010561426i, 0.1684016396+0.4008425286i, 0.3420416234+2.946830739i, 2.4915251758-1.8146857084i}");

    requireExprIsEqual("ifft{-1.2-4.75i, 5.65+4.32i}", "{2.225-0.215i, -3.425-4.535i}");

    requireExprIsEqual("ifft{-0.01+8.18i, 6.39+1.9i, -5.81-6.06i, 6.56+0.04i, -1.75-1.65i, -8.54-6.56i, -0.76+2.9i, -0.11+1.66i, -3.38+5.28i, 0.82+0.7i, -2.65-5.46i, 7.67-2.95i, 3.93+7.17i, -5.87+2.47i, 1.4-5.21i}", "{-0.1406666667+0.1606666667i, 1.3480980363-0.5580405724i, 0.1266320686+2.0676843601i, -0.5217278122-0.0734385284i, 0.3908467351+0.6546484656i, 0.2917942452+2.0882892424i, -2.2179218086+0.6523751955i, -0.6661711669+0.9891534377i, -1.5800915637-0.2392786788i, -0.9535933309-0.2643641679i, 1.9568724215+1.549044091i, 2.6040143038+1.7192912347i, 0.100576285-1.7552391658i, -0.8504367113+0.3948980354i, 0.1017749648+0.7943103844i}");

    requireExprIsEqual("ifft{9.28-9.66i, -0.28-1.89i, -7.8-2.71i, -4.37+9.58i}", "{-0.7925-1.17i, 7.1375-0.715i, 1.5325-5.015i, 1.4025-2.76i}");
}
