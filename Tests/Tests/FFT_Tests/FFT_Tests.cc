

using namespace std;

#include <Catch2>
#include "../EngineTest.h"

TEST_CASE("FFT Tests", "[fft]" ) {

    SECTION("Real Data FFT Tests"){
        requireIsEqual("fft{9.83, 1.09, 4.8}", std::vector<std::vector<gsl_complex>>{{{15.72, 0.0}, {6.885, 3.212954248}, {6.885, -3.212954248}}});
        requireIsEqual("fft(9.83, 1.09, 4.8)", std::vector<std::vector<gsl_complex>>{{{15.72, 0.0}, {6.885, 3.212954248}, {6.885, -3.212954248}}});

        requireIsEqual("fft{-7.78, 9.18, -1.9, 7.11, -3.65, 0.85, 9.18, -0.08, 5.39, -1.5}", std::vector<std::vector<gsl_complex>>{{{16.8, 0.0}, {-7.9845336222, 1.3588439441}, {-11.3587442851, -13.8482082449}, {-6.4304663778, 1.9859929848}, {-14.3662557149, -27.5901296373}, {-14.32, -0.0}, {-14.3662557149, 27.5901296373}, {-6.4304663778, -1.9859929848}, {-11.3587442851, 13.8482082449}, {-7.9845336222, -1.3588439441}}});

        requireIsEqual("fft{2.33, 3.34, 6.56, 4.35, -3.5, 5.09, -0.64, -4.43, -3.07, 2.79, 6.65, 4.31, -1.44, 5.94, 6.5, 9.05}", std::vector<std::vector<gsl_complex>>{{{43.83, 0.0}, {23.6877209033, 12.8688212298}, {-2.1215346238, -6.7418881682}, {4.9616929648, 14.6881708031}, {-24.75, -3.88}, {-4.1318985795, 8.5834067472}, {10.5215346238, 7.9581118318}, {-2.9175152886, -1.4759428262}, {-17.05, 0.0}, {-2.9175152886, 1.4759428262}, {10.5215346238, -7.9581118318}, {-4.1318985795, -8.5834067472}, {-24.75, 3.88}, {4.9616929648, -14.6881708031}, {-2.1215346238, 6.7418881682}, {23.6877209033, -12.8688212298}}});

        requireIsEqual("fft{-8.72, 5.01, 2.03, 2.75, 6.11, 1.08, 4.7, -7.48}", std::vector<std::vector<gsl_complex>>{{{5.48, 0.0}, {-19.2847727215, -7.3426320216}, {-9.34, -10.82}, {-10.3752272785, -12.6826320216}, {2.76, 0.0}, {-10.3752272785, 12.6826320216}, {-9.34, 10.82}, {-19.2847727215, 7.3426320216}}});

        requireIsEqual("fft{9.26, -3.59, 8.58, 3.48, 4.27, -9.9, 8.14, -4.62, 7.44, 8.71, 9.84, -3.62, -9.13}", std::vector<std::vector<gsl_complex>>{{{28.86, 0.0}, {-3.7590011122, 6.2950100373}, {-19.5529533607, -28.6724499571}, {5.6485870198, -10.6202373387}, {27.804906003, 10.7136349829}, {10.9162852616, -7.3801424849}, {24.7021761885, 33.7873725423}, {24.7021761885, -33.7873725423}, {10.9162852616, 7.3801424849}, {27.804906003, -10.7136349829}, {5.6485870198, 10.6202373387}, {-19.5529533607, 28.6724499571}, {-3.7590011122, -6.2950100373}}});

        requireIsEqual("fft{-1.8, 0.98, -6.84, 1.91, -5.56, -3.98, 8.22, 8.63, 7.22, -4.95, -9.04, -8.1, -4.86, 9.57, -0.18}", std::vector<std::vector<gsl_complex>>{{{-8.78, 0.0}, {-10.3653034469, -9.6579219493}, {36.198219215, 29.4878473716}, {-30.4284085981, 1.5831286153}, {-3.4743622662, 5.2469427304}, {2.17, -14.2547781463}, {-2.2315914019, -27.6344884843}, {-0.9785535019, -2.2663942715}, {-0.9785535019, 2.2663942715}, {-2.2315914019, 27.6344884843}, {2.17, 14.2547781463}, {-3.4743622662, -5.2469427304}, {-30.4284085981, -1.5831286153}, {36.198219215, -29.4878473716}, {-10.3653034469, 9.6579219493}}});

        requireIsEqual("fft{6.89, -6.42, 0.05, 4.22}", std::vector<std::vector<gsl_complex>>{{{4.74, 0.0}, {6.84, 10.64}, {9.14, 0.0}, {6.84, -10.64}}});

        requireIsEqual("fft{5.17, 5.11, -3.44, 1.82, -7.98, -4.24, -4.06, -6.32, 7.94, -1.44, 8.39}", std::vector<std::vector<gsl_complex>>{{{0.95, 0.0}, {30.4390047846, 10.9555292499}, {-0.3381305005, 1.0304699049}, {5.3909444937, -1.8502999155}, {15.5073158977, 4.1118798081}, {-23.0391346756, 3.1361672938}, {-23.0391346756, -3.1361672938}, {15.5073158977, -4.1118798081}, {5.3909444937, 1.8502999155}, {-0.3381305005, -1.0304699049}, {30.4390047846, -10.9555292499}}});

        requireIsEqual("fft{-3.24, 0.51, 9.36, 2.58, -1.83, -1.75}", std::vector<std::vector<gsl_complex>>{{{5.63, 0.0}, {-10.205, -11.6480416809}, {-3.805, 7.7336068558}, {2.95, 0.0}, {-3.805, -7.7336068558}, {-10.205, 11.6480416809}}});

        requireIsEqual("fft{4.25, -9.2, -4.76, 6.75, -5.14, 1.27, -6.71, 9.41, -8.95, 2.21, -1.13}", std::vector<std::vector<gsl_complex>>{{{-12.0, 0.0}, {-2.7629781906, 3.9108402702}, {-1.4445612488, 6.9439176221}, {14.4075013113, 22.1408477325}, {3.169963779, 2.069854806}, {16.0050743491, -34.4938737199}, {16.0050743491, 34.4938737199}, {3.169963779, -2.069854806}, {14.4075013113, -22.1408477325}, {-1.4445612488, -6.9439176221}, {-2.7629781906, -3.9108402702}}});

        requireIsEqual("fft{-6.97, 9.31, 7.74}", std::vector<std::vector<gsl_complex>>{{{10.08, 0.0}, {-15.495, -1.3596598839}, {-15.495, 1.3596598839}}});
    }

    SECTION("Complex Data FFT Tests"){
        requireIsEqual("fft{-7.27+9.26i, 8.28-3.88i, -7.17+7.81i, -7.06+1.39i, -0.95-3.33i}",
                       std::vector<std::vector<gsl_complex>>{{{-14.17, 11.25}, {9.7579066345, -9.1245641453}, {-24.0264711221, 12.4060947822}, {-11.1683416753, 23.4658429731}, {3.256906163, 8.30262639}}});

        requireIsEqual("fft(-7.27+9.26i, 8.28-3.88i, -7.17+7.81i, -7.06+1.39i, -0.95-3.33i)",
                       std::vector<std::vector<gsl_complex>>{{{-14.17, 11.25}, {9.7579066345, -9.1245641453}, {-24.0264711221, 12.4060947822}, {-11.1683416753, 23.4658429731}, {3.256906163, 8.30262639}}});

        requireIsEqual("fft{(-2.86+1.15j), (7.87-2.9j), (0.2+7.96j), 2.93j, (6.91+8.74j), (2.54+3.41j), (5.42+4.84j), (9.64-5.06j), (3.19+2.62j)}", std::vector<std::vector<gsl_complex>>{{{32.91, 23.69}, {5.1739225242, -4.3756092341}, {-8.411892525, 0.5336039286}, {-24.055195584, -14.477809716}, {-23.9443275007, 3.1883664405}, {10.3760319274, 0.5305699145}, {-1.174804416, 17.547809716}, {-2.9019205871, 7.0638158592}, {-13.7118138387, -23.3507469087}}});

        requireIsEqual("fft{(1.53-9.41j), (3.97+7.56j), (-1.23-4.04j), (0.01+2.98j), (1.05-7.49j), (-1.45+3.1j), (-9.81+5.55j), (-0.09+0.86j), (5.51+0.4j), (4.35+8.9j), (-9.65+3.27j), (-8.6-8.99j), (6.49-2.83j), (-1.68+3.71j), (-1.4-4.81j)}", std::vector<std::vector<gsl_complex>>{{{-11.0, -1.24}, {13.6628304601, -25.0242876929}, {22.2289173738, 3.6281828412}, {-20.6334223431, 13.064481657}, {23.2910620128, -73.3366678179}, {28.6240652342, 7.7381604391}, {18.5393660013, 8.8149113369}, {0.8641065424, -27.3537153973}, {-22.1772669769, -17.4491068827}, {-15.2186049201, -15.392419101}, {-9.9140652342, 9.0718395609}, {2.3350065902, -3.4947965085}, {-19.5373387381, -20.4469738929}, {6.7599446256, 18.1607897921}, {5.125399372, -17.8903983339}}});

        requireIsEqual("fft{(7.96+8.61j), (-5.93-4.11j), (7.71-4.37j), (6.69+9.7j), (-2.93+2.59j), (-4.87-1.71j), (3.21+3.1j), (4.25+4.41j), (6.57-5.04j), (4.81+7.62j), (-4.03+0.14j), (-2.23-1.97j), (4.43+3.46j), (6.93-1.92j), (-4.2-5.71j)}", std::vector<std::vector<gsl_complex>>{{{28.37, 14.8}, {6.8611345562, -7.0183692064}, {16.0446779591, -9.1911652988}, {-39.4475811535, 7.1963023831}, {-9.3244874115, 14.4925716011}, {43.7075657893, 45.3966591437}, {11.1259585638, 5.6704206651}, {38.2943395302, 6.7423284212}, {10.8882126925, 6.0595134831}, {21.3648318429, 9.8066997618}, {9.2224342107, 37.2733408563}, {6.5701748917, 9.7331589707}, {-26.1132092532, -2.27342281}, {8.9858441294, -0.8775649763}, {-7.1498963477, -8.6604729947}}});

        requireIsEqual("fft{(-0.22+8.34j), (-1.34-5.92j), (-2.02+6.08j), (-7.11+6.72j), (-4.56+4.3j), (-8.04+1.25j), (2.24-4.59j), (5.93-4.19j), (1.23+5j), (0.25+2.2j), (2.05-9.99j)}", std::vector<std::vector<gsl_complex>>{{{-11.59, 9.2}, {20.6406218931, 22.8368060921}, {-3.6093708194, -31.2536588714}, {14.2598303189, 18.3781226899}, {-11.8585827458, 24.375326861}, {1.2615029635, 30.0812668249}, {4.4482309985, 16.753076918}, {-6.3484914135, 27.5185300398}, {-6.4891736218, 1.2380052056}, {7.212620868, -4.2707387618}, {-10.3471884415, -23.1167369983}}});

        requireIsEqual("fft{(6.03-1.5j), (8.99-2.77j), (-5.64+4.87j), (-7.79-0.69j), (-7.97-8.43j), (-9.86+7.59j), (-3+1.39j), (5.4-2.94j), (-8.16+1.56j), (-9.73-3.08j), (-7.41-3.62j), (-8.29+8.27j), (9.03-8.84j), (0.77+3.67j), (-2.94+8.65j)}", std::vector<std::vector<gsl_complex>>{{{-40.57, 4.13}, {30.8039500952, 18.3262964173}, {16.5088557979, 22.896763271}, {-10.6165713618, -25.8988802423}, {-2.9485507985, -28.2699542793}, {-26.9021239324, -51.1701007492}, {21.9647345783, 10.4941344046}, {4.0898146549, 5.863493561}, {-26.5503984056, 5.7166103073}, {-11.2762720645, -13.5395519326}, {51.0921239324, 8.8801007492}, {28.5027496173, -1.9305829611}, {-15.701891152, 37.1642977703}, {38.8283859981, -11.6161252519}, {33.2251930407, -3.5465010644}}});

        requireIsEqual("fft{(-5.87+1.46j), (3.07-8.55j), (6.27+8.65j)}", std::vector<std::vector<gsl_complex>>{{{3.47, 1.56}, {-25.4356369451, 4.1812812921}, {4.3556369451, -1.3612812921}}});

        requireIsEqual("fft{(-4.23-5.85j), (0.92-8.71j), (-7.32-9.54j), (1.64+2.48j), (-8.88-2.56j), (-8.95+4.89j), (5.74-7.09j), (-9.33+9.03j), (6.34-2.33j), (-4.09-5.36j), (-8.68-7.08j), (-0.78-2.31j), (0.24-5.02j), (7.17+9.97j), (-0.18-8.09j), (9.39+3.29j)}", std::vector<std::vector<gsl_complex>>{{{-21.0, -34.28}, {17.2985176587, 11.2884331501}, {-21.2865104219, 9.5119412126}, {-16.566567383, -20.5148059229}, {-7.79, 21.91}, {6.5134817836, 33.2152355834}, {-15.3093827203, -9.8775552108}, {-43.5939548253, 12.5858668303}, {-12.94, -60.84}, {-42.0320833042, -15.27708681}, {39.9065104219, 32.4080587874}, {-5.1093705737, -10.1674898854}, {15.61, 10.17}, {-14.2199161381, -6.8265819235}, {39.6893827203, -34.4424447892}, {13.1498927819, -32.4635710221}}});

        requireIsEqual("fft{(-8.58-0.47j), (2.07+3.54j), (7.82-7.71j), (-5.99+6.45j), (0.22+4.36j), (6.83-4.11j), (-5.96-6.55j)}", std::vector<std::vector<gsl_complex>>{{{-3.59, -4.49}, {-3.7809604549, -14.0048477436}, {-14.746147342, 5.3348650487}, {14.5729198833, -4.1889553845}, {-3.8872393187, -10.8774135388}, {-34.2760999348, 29.8434645271}, {-14.3524728329, -4.9071129089}}});

        requireIsEqual("fft{(-3.5-9.77j), (-7.13+0.71j), (2.73+8.72j), (-8.43-4.6j), (-2.19-6.48j), (1.06-7.03j), (7.26-8.25j), (-7.02-1.28j), (9.86-8.89j), (5.24-5.93j), (8.52+4.12j), (4.68+3.68j), (-7.3+6.49j), (-0.8-5.08j), (3.85-8.07j), (-8.03+2.08j)}", std::vector<std::vector<gsl_complex>>{{{-1.2, -39.58}, {-55.996335501, 20.630222284}, {39.1551558518, -19.1918376618}, {24.8961430161, 18.3980183648}, {-42.7, -32.34}, {-24.7150254828, -14.5377934425}, {-0.1436717343, -31.0882164339}, {-0.1266011917, 13.851575609}, {39.66, -4.68}, {-3.4236053271, -22.4844531774}, {50.8648441482, -18.4281623382}, {-6.4145542966, -13.3321309145}, {-8.28, 2.0}, {-21.185033689, -7.5679756641}, {-26.4763282657, -5.9717835661}, {-19.9149875278, -1.9974630593}}});

        requireIsEqual("fft{(0.07+4.03j), (6.18+1.12j), (-3.23-8.87j), (-4.52-2.28j), (-4.02+8.16j), (-2.75+9j), (6.21+3.47j), (-1.59+8.32j), (8.45-0.72j), (4.64+2.07j), (-0.06+5.26j), (6.08+4.76j), (9.91-5.98j), (5.18-3.98j), (-8.53-9.09j)}", std::vector<std::vector<gsl_complex>>{{{22.02, 15.27}, {-0.0442385756, -7.2687621206}, {-1.112227959, -5.4960508122}, {-2.8921444972, 9.7354336793}, {3.9059195109, -10.0461487809}, {34.0664046101, -10.5803640395}, {-2.4974366515, -13.700430016}, {19.8664044807, 17.5066720922}, {-9.4491303117, 0.8972536735}, {-11.2929196295, 24.957614286}, {-7.1564046101, -0.7596359605}, {-5.5595977503, 50.3586566216}, {-19.0374992218, 55.1873820506}, {6.9979942448, -3.2840835492}, {-26.7651236398, -62.3275371244}}});
    }

}

TEST_CASE("IFFT Tests", "[ifft]" ) {

    requireIsEqual("ifft{15.72, 6.885+3.212954248i, 6.885-3.212954248i}", std::vector<std::vector<double>>{{9.83, 1.09, 4.8}});
    requireIsEqual("ifft(15.72, 6.885+3.212954248i, 6.885-3.212954248i)", std::vector<std::vector<double>>{{9.83, 1.09, 4.8}});
    requireIsEqual("ifft{-14.17+11.25i, 9.7579066345-9.1245641453i, -24.0264711221+12.4060947822i, -11.1683416753+23.4658429731i, 3.256906163+8.30262639i}",
                   std::vector<std::vector<gsl_complex>>{{{-7.27, 9.26}, {8.28, -3.88}, {-7.17, 7.81}, {-7.06, 1.39}, {-0.95, -3.33}}});

    requireIsEqual("ifft{(5.35-9.98j), (6.58-0.88j), (-0.82-2.45j), (-7.88+9.62j), (1.3-2.35j), (-2.5+2.04j), (5.63+7.95j), (8.36+4.83j), (7.46+7.13j), (-6.67-8.17j)}", std::vector<std::vector<gsl_complex>>{{{1.681, 0.774}, {1.0399039707, -4.4968056332}, {-0.9079134805, -0.3084259568}, {0.5082943371, 2.3307113514}, {-2.4489299969, 0.3525458599}, {2.103, -0.714}, {2.3522349485, -0.2000251133}, {0.498856586, -2.2484723509}, {0.7486085288, -4.5880947898}, {-0.2250548938, -0.8814333674}}});

    requireIsEqual("ifft{(-1.17+9.16j), (-4.29-2.37j), (-0.82+0.83j), (3.53-1.97j), (-8.38-0.46j), (3.83-4j)}", std::vector<std::vector<gsl_complex>>{{{-1.2166666667, 0.1983333333}, {-0.4764656965, 1.2125042956}, {1.1492585605, -0.5648797219}, {-2.24, 2.9783333333}, {1.2474081062, 3.9615463886}, {0.3664656965, 1.374162371}}});

    requireIsEqual("ifft{(2.75+4.09j), (8.01+1.7j), (-2.48-4.82j), (-6.87-4.58j), (1.9-9.69j), (3.4-2.45j), (-8.59+2.42j), (-3.34+10j), (5.16+0.37j), (-9.58+4.33j)}", std::vector<std::vector<gsl_complex>>{{{-0.964, 0.137}, {3.4941738015, 2.0131636888}, {-0.4845901699, 0.4808776321}, {-1.0262337456, 4.3686299955}, {1.3863798902, 1.1025045131}, {0.712, -1.663}, {0.714736591, -0.5139190016}, {-1.5058454681, -2.2856156536}, {2.4224736888, -0.3864631436}, {-1.9990945877, 0.8368219693}}});

    requireIsEqual("ifft{(-4.69+8.42j), (-3.87+0.11j), (-6.44-8.94j)}", std::vector<std::vector<gsl_complex>>{{{-5.0, -0.1366666667}, {-2.4575099681, 5.0202284292}, {2.7675099681, 3.5364382374}}});

    requireIsEqual("ifft{(4.3-0.98j), (6.03-3.29j), (9-8.8j), (-2.74+6.28j)}", std::vector<std::vector<gsl_complex>>{{{4.1475, -1.6975}, {1.2175, 4.1475}, {2.5025, -3.1925}, {-3.5675, -0.2375}}});

    requireIsEqual("ifft{(3.41-5.54j), (-9.19-8.33j), (3.7+3.2j), (-4.05+7.26j)}", std::vector<std::vector<gsl_complex>>{{{-1.5325, -0.8525}, {3.825, -3.47}, {5.0875, -0.3175}, {-3.97, -0.9}}});

    requireIsEqual("ifft{(-7.15-8.78j), (2.61+1.52j), (5.41-6.55j), (-6.17+6.15j), (3.99+4.96j), (0.58+3.51j), (-5.01+6.15j)}", std::vector<std::vector<gsl_complex>>{{{-0.82, 0.9942857143}, {0.699452732, -1.0104192543}, {-1.7560765376, 1.7794116552}, {-1.1120546264, -4.3476239067}, {0.8926617213, -1.3832468907}, {-2.064483761, -2.0139312284}, {-2.9894995282, -2.7984760894}}});

    requireIsEqual("ifft{(-0.38+2.97j), (5.07-4.95j), (-3.71+9.3j), (3.57-0.71j), (0.54-2.54j), (-4.59+4.02j), (-4.11-7.76j), (7.6+1.88j), (-9.35-2.04j), (-5.89-1.24j)}", std::vector<std::vector<gsl_complex>>{{{-1.125, -0.107}, {-1.0261985288, 1.4863502122}, {-0.449245636, 0.6759346508}, {2.6669710657, 0.6652684621}, {1.6494682061, 1.7447911929}, {-2.277, 0.093}, {-2.0499597089, 2.842349507}, {1.9255659421, -2.1146631306}, {-0.5102628612, -1.6610753507}, {0.8156615209, -0.6549555437}}});

    requireIsEqual("ifft{(5.13+2.29j), (-6.17+9.73j), (4.18-4.71j), (-3.79+5.11j), (-8.61+5.08j), (-7.44-8.72j), (2.34-5.12j)}", std::vector<std::vector<gsl_complex>>{{{-2.0514285714, 0.5228571429}, {-0.1276012413, 0.8197810589}, {-1.6466015163, 0.3729654492}, {0.8528737818, -2.9403575352}, {1.8063815299, -0.6323347039}, {1.9860701287, 5.2606206854}, {4.3103058886, -1.1135320972}}});

    requireIsEqual("ifft{(-4.31+7.77j), (-8.7-3.16j), (8.58-1.86j), (0.12-7.32j), (2.86-8.21j), (-7.49-1.02j), (-3.75-5.79j), (2.98+5.87j), (-5.21+0.73j), (8.67-2.83j), (0.71-0j)}", std::vector<std::vector<gsl_complex>>{{{-0.5036363636, -1.4381818182}, {1.9918385797, 1.0118000072}, {-3.25571991, 0.2242918568}, {-0.8617444871, -0.4141238499}, {-0.0073713489, 0.3278640725}, {1.3814790607, 0.818369734}, {3.205222011, 1.2123836992}, {-2.9175882675, 0.4683528456}, {-0.8773583078, 2.6819820918}, {-1.1676442251, 1.6767489178}, {-1.2974767413, 1.2005124432}}});

}
